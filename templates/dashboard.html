{% extends "base.html" %}
{% set title = "Main Page" %}
{% block content %}

<div class="grid2">
  <div class="card">
    <div class="card-head">
      <div>
        <div class="card-title">Summary</div>
        <div class="card-sub">Folders: {{ folders|length }} · Items: {{ totals.product_count }}</div>
      </div>
      <div class="stats">
        <div class="stat">
          <div class="stat-k">Total Qty</div>
          <div class="stat-v">{{ totals.total_qty }}</div>
        </div>
        <div class="stat">
          <div class="stat-k">Total Value</div>
          <div class="stat-v">Rp {{ "{:,.0f}".format(totals.total_value) }}</div>
        </div>
      </div>
    </div>

    <div class="folders">
      {% for f in folders %}
      <div class="folder">
        <div class="folder-ico"><i class="bi bi-folder"></i></div>
        <div>
          <div class="folder-name">{{ f.name }}</div>
          <div class="folder-sub">{{ f.count }} items</div>
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="toolbar">
      <form method="GET" action="{{ url_for('dashboard') }}" class="search">
        <i class="bi bi-search"></i>
        <input name="q" value="{{ q }}" placeholder="Search SKU / name">
      </form>
    </div>

    <div class="list">
      {% for p in products %}
      <div class="row">
        <div class="thumb">
          <div class="thumb-box"><i class="bi bi-box-seam"></i></div>
        </div>
        <div class="row-main">
          <div class="row-title">{{ p.name }}</div>
          <div class="row-sub">
            SKU: <b>{{ p.sku }}</b> · Stock: <b class="{{ 'danger' if p.stock_qty<=p.min_level else '' }}">{{ p.stock_qty }}</b> {{ p.unit }}
            · Min: {{ p.min_level }}
          </div>
          <div class="row-meta">
            <span class="tag">Retail: Rp {{ "{:,.0f}".format(p.retail_price) }}</span>
            <span class="tag soft">Reseller: Rp {{ "{:,.0f}".format(p.reseller_price) }}</span>
            <a class="tag link" href="{{ url_for('barcode_png', sku=p.sku) }}" target="_blank">
              <i class="bi bi-upc-scan"></i> Barcode PNG
            </a>
          </div>
        </div>
        <div class="row-side">
          <div class="note">
            <div class="note-k">Notes</div>
            <div class="note-v">{{ p.notes or "-" }}</div>
          </div>
        </div>
      </div>
      {% endfor %}
      {% if products|length == 0 %}
        <div class="empty">Tidak ada item.</div>
      {% endif %}
    </div>
  </div>

  <div class="stack">
    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Stock Barang & Harga</div>
          <div class="card-sub">Tambah / update master produk (retail vs reseller)</div>
        </div>
      </div>

      <form class="form grid" method="POST" action="{{ url_for('product_upsert') }}">
        <div>
          <label>SKU</label>
          <input name="sku" placeholder="SKU-001" required>
        </div>
        <div>
          <label>Nama</label>
          <input name="name" placeholder="Nama barang" required>
        </div>
        <div>
          <label>Unit</label>
          <input name="unit" placeholder="pcs / box / bottle" value="pcs">
        </div>
        <div>
          <label>Cost / Modal</label>
          <input name="cost_price" type="number" step="0.01" value="0">
        </div>
        <div>
          <label>Min Level</label>
          <input name="min_level" type="number" value="0">
        </div>
        <div>
          <label>Retail Price</label>
          <input name="retail_price" type="number" step="0.01" value="0">
        </div>
        <div>
          <label>Reseller Price</label>
          <input name="reseller_price" type="number" step="0.01" value="0">
        </div>
        <div class="full">
          <label>Notes</label>
          <input name="notes" placeholder="contoh: UNLINE / serial / dll">
        </div>
        <div class="full">
          <button class="btn primary" type="submit"><i class="bi bi-save"></i> Save Product</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Input/Update Barang Masuk</div>
          <div class="card-sub">Tambah stok + opsional update harga</div>
        </div>
      </div>

      <form class="form grid" method="POST" action="{{ url_for('stockin_add') }}">
        <div>
          <label>SKU</label>
          <input name="sku" placeholder="SKU-001" required>
        </div>
        <div>
          <label>Qty Masuk</label>
          <input name="qty" type="number" value="1" required>
        </div>
        <div>
          <label>Cost / Unit</label>
          <input name="cost_per_unit" type="number" step="0.01" placeholder="kosongkan untuk pakai modal default">
        </div>
        <div>
          <label>New Retail Price</label>
          <input name="new_retail_price" type="number" step="0.01" placeholder="(optional)">
        </div>
        <div>
          <label>New Reseller Price</label>
          <input name="new_reseller_price" type="number" step="0.01" placeholder="(optional)">
        </div>
        <div class="full">
          <button class="btn primary" type="submit"><i class="bi bi-plus-circle"></i> Add Stock</button>
        </div>
      </form>
    </div>

    <div class="card">
      <div class="card-head">
        <div>
          <div class="card-title">Barang Keluar Manual (Offline)</div>
          <div class="card-sub">Input penjualan offline → stok berkurang & masuk CashFlow</div>
        </div>
      </div>
    
      <form class="form grid" method="POST" action="{{ url_for('manual_sale') }}">
        <div>
          <label>SKU</label>
          <input name="sku" placeholder="SKU-001" required>
        </div>
    
        <div>
          <label>Qty Keluar</label>
          <input name="qty" type="number" value="1" min="1" required>
        </div>
    
        <div>
          <label>Harga Jual (opsional)</label>
          <input name="price" type="number" step="0.01" placeholder="kosongkan = pakai Retail Price">
        </div>
    
        <div class="full">
          <label>Catatan (opsional)</label>
          <input name="note" placeholder="contoh: cash, transfer, pembeli A, dll">
        </div>
    
        <div class="full">
          <button class="btn primary" type="submit">
            <i class="bi bi-receipt"></i> Simpan Penjualan Offline
          </button>
          <a class="btn ghost" href="{{ url_for('cashflow') }}" style="margin-left:10px;">
            <i class="bi bi-graph-up"></i> Lihat CashFlow
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
